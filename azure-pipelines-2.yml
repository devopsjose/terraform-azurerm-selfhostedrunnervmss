trigger: none

variables:
  service_connection: DevOpsMI-ServiceConnection  # Your service connection name

stages:

- stage: TerraformPlan
  displayName: "üìù Terraform Plan"
  jobs:
  - job: Plan
    displayName: "Terraform Init & Plan"
    pool:
      name: Default  # Use your self-hosted agent pool name (usually 'Default')
    steps:

    - task: AzureCLI@2
      displayName: "Terraform Init & Plan"
      inputs:
        azureSubscription: $(service_connection)
        scriptType: pscore  # Since it's a Windows VM, use PowerShell Core (not Bash)
        addSpnToEnvironment: true
        useGlobalConfig: true
        scriptLocation: inlineScript
        inlineScript: |
          # Stop on error
          $ErrorActionPreference = "Stop"

          Write-Host "üîµ Checking Terraform version"
          terraform -
 